
# üìù Laporan Tugas Akhir

**Mata Kuliah**: Sistem Operasi  
**Semester**: Genap / Tahun Ajaran 2024‚Äì2025  
**Nama**: `Fakhri Fahmi Ramadan`  
**NIM**: `240202897`  
**Modul yang Dikerjakan**:  
**Modul 3 ‚Äì Manajemen Memori Tingkat Lanjut (xv6-public x86)**

---

## üìå Deskripsi Singkat Tugas

Pada modul ini, saya mengembangkan dua fitur penting dalam sistem manajemen memori xv6:

1. **Copy-on-Write (CoW) Fork**  
   Teknik ini menghindari penyalinan memori secara langsung saat proses melakukan `fork()`. Memori anak dan induk berbagi halaman secara read-only, dan salinan hanya dilakukan jika salah satu proses menulis ke halaman tersebut.

2. **Shared Memory ala System V**  
   Menambahkan dua system call `shmget()` dan `shmrelease()` untuk memungkinkan proses saling berbagi memori menggunakan *key* tertentu. Halaman disimpan secara global dan dibagi berdasarkan *reference count*.

---

## üõ†Ô∏è Rincian Implementasi

### 1. Copy-on-Write Fork

- Menambahkan array `ref_count[]` di `vm.c` untuk menyimpan reference count tiap halaman fisik.
- Menambahkan fungsi `incref()` dan `decref()` untuk manajemen ref_count.
- Menambahkan flag `PTE_COW` di `mmu.h`.
- Membuat fungsi `cowuvm()` di `vm.c` yang menggantikan `copyuvm()` pada proses fork.
- Menyesuaikan `fork()` di `proc.c` agar menggunakan `cowuvm()`.
- Menangani **page fault** di `trap.c`, dengan menyalin halaman jika flag `PTE_COW` aktif dan terjadi akses tulis.

### 2. Shared Memory ala System V

- Menambahkan struktur array `shmtab[]` di `vm.c` untuk menyimpan *shared page*, key, dan refcount.
- Menambahkan dua system call di `sysproc.c`:
  - `shmget(int key)` ‚Üí mengalokasikan atau mengambil shared memory.
  - `shmrelease(int key)` ‚Üí mengurangi refcount dan membebaskan memori jika tidak digunakan.
- Mendaftarkan syscall baru di file `syscall.h`, `user.h`, `usys.S`, dan `syscall.c`.

---

## ‚úÖ Uji Fungsionalitas

### Program Uji:

- `cowtest.c` ‚Üí menguji perilaku Copy-on-Write saat proses anak dan induk mengakses halaman memori yang sama.
- `shmtest.c` ‚Üí menguji shared memory antar proses dengan key yang sama.

---

## üì∑ Hasil Uji

### üìç Hasil Output `cowtest`:

```

Child sees: Y
Parent sees: X

```

‚û°Ô∏è Menunjukkan bahwa anak menulis salinannya sendiri, tanpa mengubah data induk.

### üìç Hasil Output `shmtest`:

```

Child reads: A
Parent reads: B

```

‚û°Ô∏è Memastikan bahwa perubahan di memori bersama dapat dilihat oleh proses lain.

> üì∏ Jika ada screenshot:
>
> `![hasil cowtest], [hasil shmtest]
><img width="1919" height="1079" alt="modul3" src="https://github.com/user-attachments/assets/3a252412-25b7-4afb-9e44-5a36e34c7372" />

> 

---

## ‚ö†Ô∏è Kendala yang Dihadapi

- Implementasi awal page fault pada flag `PTE_COW` salah menangani bit permission, menyebabkan kernel panic.
- Proses alokasi memori bersama menggunakan `USERTOP` menyebabkan bentrok jika dialokasikan lebih dari batas maksimum (melebihi 16 halaman).
- Lupa menambahkan `incref()` setelah `kalloc()` menyebabkan refcount nol dan halaman langsung dibebaskan oleh proses lain.

---

## üìö Referensi

- Buku xv6: [MIT Operating System Engineering](https://pdos.csail.mit.edu/6.828/2018/xv6/book-rev11.pdf)
- xv6-public GitHub: [https://github.com/mit-pdos/xv6-public](https://github.com/mit-pdos/xv6-public)
- Diskusi praktikum dan Stack Overflow terkait page fault dan manajemen memori xv6

---
```

